specVersion: 0.0.5
features:
  - nonFatalErrors
schema:
  file: ./src/schema.graphql
dataSources:
{{#dataSources}}
  {{&subTemplate}}
{{/dataSources}}
templates:
  - kind: ethereum/contract
    name: RegistryCommunity
    network: {{network}}
    source:
      abi: RegistryCommunity
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - RegistryCommunity
        - ERC20
        - CVStrategy
        - TokenGarden
        - Member
      abis:
        - name: RegistryCommunity
          file: ../contracts/abis/DiamondAggregated/RegistryCommunity.json
        - name: ERC20
          file: ../contracts/abis/ERC20.sol/ERC20.json
        - name: CVStrategy
          file: ../contracts/abis/DiamondAggregated/CVStrategy.json
        - name: RegistryFactory
          file: ../contracts/abis/RegistryFactory.sol/RegistryFactory.json
     
      eventHandlers:
        - event: RegistryInitialized(bytes32,string,(uint256,string))
          handler: handleInitialized
        - event: MemberRegistered(address,uint256)
          handler: handleMemberRegistered
        - event: MemberRegisteredWithCovenant(address,uint256,string)
          handler: handleMemberRegisteredWithCovenant
        - event: MemberUnregistered(address,uint256)
          handler: handleMemberUnregistered
        - event: PoolCreated(uint256,address,address,address,(uint256,string))
          handler: handlePoolCreated
        - event: MemberKicked(address,address,uint256)
          handler: handleMemberKicked
        - event: CommunityFeeUpdated(uint256)
          handler: handleCommunityFeeUpdated
        # - event: ProtocolFeeUpdated(uint256)
        #   handler: handleProtocolFeeUpdated
        - event: StrategyAdded(address)
          handler: handleStrategyAdded
        - event: StrategyRemoved(address)
          handler: handleStrategyRemoved
        - event: MemberActivatedStrategy(address,address,uint256)
          handler: handleMemberActivatedStrategy
        - event: MemberDeactivatedStrategy(address,address)
          handler: handleMemberDeactivatedStrategy
        - event: MemberPowerDecreased(address,uint256)
          handler: handleMemberPowerDecreased
        - event: MemberPowerIncreased(address,uint256)
          handler: handleMemberPowerIncreased
        - event: BasisStakedAmountUpdated(uint256)
          handler: handleBasisStakedAmountUpdated
        - event: CouncilSafeUpdated(address)
          handler: handleCouncilSafeUpdated
        - event: CouncilSafeChangeStarted(address,address)
          handler: handleCouncilSafeChangeStarted
        - event: KickEnabledUpdated(bool)
          handler: handleKickEnabledUpdated
        - event: CovenantIpfsHashUpdated(string)
          handler: handleCovenantIpfsHashUpdated
        - event: CommunityNameUpdated(string)
          handler: handleCommunityNameUpdated
        - event: FeeReceiverChanged(address)
          handler: handleFeeReceiverChanged
        - event: PoolRejected(address)
          handler: handlePoolRejected
        - event: CommunityArchived(bool)
          handler: handleCommunityArchived
      file: ./src/mappings/registry-community.ts

  - kind: ethereum/contract
    name: CVStrategy
    network: {{network}}
    source:
      abi: CVStrategy
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - CVStrategy
        - CVStrategyConfig
        - CVProposal
        - StreamInfo
        - Allo
      abis:
        - name: CVStrategy
          file: ../contracts/abis/DiamondAggregated/CVStrategy.json
        - name: RegistryCommunity
          file: ../contracts/abis/DiamondAggregated/RegistryCommunity.json
        - name: Allo
          file: ../contracts/abis/Allo.sol/Allo.json
      eventHandlers:
        - event: InitializedCV(uint256,((uint256,uint256,uint256,uint256),uint8,uint8,(uint256),(address,address,uint256,uint256,uint256,uint256),address,address))
          handler: handleInitialized
        - event: InitializedCV2(uint256,((uint256,uint256,uint256,uint256),uint8,uint8,(uint256),(address,address,uint256,uint256,uint256,uint256),address,address,uint256,address[]))
          handler: handleInitializedV2
        - event: InitializedCV3(uint256,((uint256,uint256,uint256,uint256),uint8,uint8,(uint256),(address,address,uint256,uint256,uint256,uint256),address,address,uint256,address[],address))
          handler: handleInitializedV3
        - event: InitializedCV4(uint256,((uint256,uint256,uint256,uint256),uint8,uint8,(uint256),(address,address,uint256,uint256,uint256,uint256),address,address,address,uint256,address[],address,uint256))
          handler: handleInitializedV4
        - event: ProposalCreated(uint256,uint256)
          handler: handleProposalCreated
        - event: SupportAdded(address,uint256,uint256,uint256,uint256)
          handler: handleSupportAdded
        - event: Distributed(uint256,address,uint256)
          handler: handleDistributed
        - event: PowerIncreased(address,uint256,uint256)
          handler: handlePowerIncreased
        - event: PowerDecreased(address,uint256,uint256)
          handler: handlePowerDecreased
        - event: PointsDeactivated(address)
          handler: handlePointsDeactivated
        - event: CVParamsUpdated((uint256,uint256,uint256,uint256))
          handler: handleCVParamsUpdated
        - event: ProposalDisputed(address,uint256,uint256,address,string,uint256)
          handler: handleProposalDisputed
        - event: Ruling(indexed address,indexed uint256,uint256)
          handler: handleDisputeRuled
        - event: ProposalCancelled(uint256)
          handler: handleProposalCancelled
        - event: ArbitrableConfigUpdated(uint256,address,address,uint256,uint256,uint256,uint256)
          handler: handleArbitrableConfigUpdated
        - event: AllowlistMembersAdded(uint256,address[])
          handler: handleAllowlistMembersAdded
        - event: AllowlistMembersRemoved(uint256,address[])
          handler: handleAllowlistMembersRemoved
        - event: SybilScorerUpdated(address)
          handler: handleSybilScorerUpdated
        - event: SuperfluidTokenUpdated(address)
          handler: handleSuperfluidTokenUpdated
        - event: SuperfluidPoolCreated(indexed address,indexed address,uint256)
          handler: handleSuperfluidPoolCreated
        - event: SuperfluidStreamingRateUpdated(uint256)
          handler: handleSuperfluidStreamingRateUpdated
        - event: SuperfluidGDAConnected(indexed address,indexed address)
          handler: handleSuperfluidGDAConnected
        - event: SuperfluidGDADisconnected(indexed address,indexed address)
          handler: handleSuperfluidGDADisconnected
        - event: StreamRateUpdated(indexed address,uint256)
          handler: handleStreamRateUpdated
        - event: ProposalEdited(uint256,(uint256,string),address,uint256)
          handler: handleProposalEdited

      file: ./src/mappings/cv-strategy.ts

  - kind: ethereum/contract
    name: CollateralVault
    network: {{network}}
    source:
      abi: CollateralVault
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - CollateralVault
        - CollateralVaultDeposit
      abis:
        - name: CollateralVault
          file: ../contracts/abis/CollateralVault.sol/CollateralVault.json
      eventHandlers:
        - event: CollateralDeposited(uint256,indexed address,uint256)
          handler: handleCollateralDeposited
        - event: CollateralWithdrawn(uint256,indexed address,indexed address,uint256,bool)
          handler: handleCollateralWithdrawnFor
        - event: CollateralWithdrawn(uint256,indexed address,uint256,bool)
          handler: handleCollateralWithdrawn
      file: ./src/mappings/cv-strategy.ts  
  
  - name: ProposalDisputeMetadata
    kind: file/ipfs
    mapping:
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/mappings/proposal-metadata.ts
      handler: handleProposalDisputeMetadata
      entities:
        - ProposalDisputeMetadata
      abis:
        - name: CVStrategy
          file: ../contracts/abis/CVStrategy.sol/CVStrategy.json
  
  - name: ProposalMetadata
    kind: file/ipfs
    mapping:
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/mappings/proposal-metadata.ts
      handler: handleProposalMetadata
      entities:
        - ProposalMetadata
      abis:
        - name: CVStrategy
          file: ../contracts/abis/CVStrategy.sol/CVStrategy.json
  
  - name: PoolMetadata
    kind: file/ipfs
    mapping:
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/mappings/pool-metadata.ts
      handler: handlePoolMetadata
      entities:
        - PoolMetadata
      abis:
        - name: CVStrategy
          file: ../contracts/abis/CVStrategy.sol/CVStrategy.json

  - name: Covenant
    kind: file/ipfs
    mapping:
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/mappings/covenant.ts
      handler: handleCovenant
      entities:
        - Covenant
      abis:
        - name: CVStrategy
          file: ../contracts/abis/CVStrategy.sol/CVStrategy.json
